# Enable native HFP/HSP backend for PipeWire
# This allows Bluetooth headsets to use their microphone

context.modules = [
    {   name = libpipewire-module-loopback
        args = {
            node.description = "Bluetooth HFP/HSP Loopback"
            capture.props = {
                node.target = "bluez_input.autoconnect"
                media.class = "Audio/Source"
                audio.position = [ FL FR ]
            }
            playback.props = {
                node.target = "bluez_output.autoconnect"
                media.class = "Audio/Sink"
                audio.position = [ FL FR ]
            }
        }
        flags = [ nofail ]
    }
]

context.properties = {
    # Enable native HFP backend
    bluez5.enable-sbc-xq = true
    bluez5.enable-msbc = true
    bluez5.enable-hw-volume = true
    bluez5.headset-roles = [ hsp_hs hsp_ag hfp_hf hfp_ag ]
}

context.spa-libs = {
    api.bluez5.* = bluez5/libspa-bluez5
}

monitor.bluez.properties = {
    bluez5.enable-sbc-xq = true
    bluez5.enable-msbc = true
    bluez5.enable-hw-volume = true
    bluez5.headset-roles = [ hsp_hs hsp_ag hfp_hf hfp_ag ]
    bluez5.codecs = [ sbc sbc_xq aac ]
    bluez5.default.rate = 48000
    bluez5.default.channels = 2
}