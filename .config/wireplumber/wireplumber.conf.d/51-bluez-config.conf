# WirePlumber Bluetooth configuration
# Enable HFP/HSP profiles and automatic switching

monitor.bluez.properties = {
    bluez5.enable-sbc-xq = true
    bluez5.enable-msbc = true
    bluez5.enable-hw-volume = true
    bluez5.headset-roles = [ hsp_hs hsp_ag hfp_hf hfp_ag ]
    bluez5.codecs = [ sbc sbc_xq aac ]
    bluez5.hfphsp-backend = "native"
    bluez5.default.rate = 48000
    bluez5.default.channels = 2
}

monitor.bluez.rules = [
    {
        matches = [
            {
                device.name = "~bluez_card.*"
            }
        ]
        actions = {
            update-props = {
                bluez5.auto-connect = [ hfp_hf hsp_hs a2dp_sink ]
                bluez5.hw-volume = [ hfp_hf hsp_hs a2dp_sink ]
                bluez5.profile = "a2dp-sink"
                device.profile-set = "default"
            }
        }
    }
    {
        matches = [
            {
                node.name = "~bluez_input.*"
                media.class = "Audio/Source"
            }
        ]
        actions = {
            update-props = {
                node.pause-on-idle = false
                session.suspend-timeout-seconds = 0
            }
        }
    }
    {
        matches = [
            {
                node.name = "~bluez_output.*"
                media.class = "Audio/Sink"
            }
        ]
        actions = {
            update-props = {
                node.pause-on-idle = false
                session.suspend-timeout-seconds = 0
            }
        }
    }
]

wireplumber.settings = {
    bluetooth.autoswitch-to-headset-profile = true
}