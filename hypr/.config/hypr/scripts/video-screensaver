#!/bin/bash

# Simple video screensaver
# Plays random video on top layer, waits to be killed by hypridle

# If a video is provided as argument, use it; otherwise pick random
if [ -n "$1" ]; then
    SCREENSAVER_VIDEO="$1"
else
    # Pick a random video from the aerial-videos directory
    VIDEO_DIR="$HOME/Videos/aerial-screensavers"
    
    # Get list of video files
    VIDEOS=("$VIDEO_DIR"/*.mov)
    
    # Check if any videos exist
    if [ ${#VIDEOS[@]} -eq 0 ] || [ ! -f "${VIDEOS[0]}" ]; then
        echo "No videos found in $VIDEO_DIR"
        exit 1
    fi
    
    # Pick a random video
    RANDOM_INDEX=$((RANDOM % ${#VIDEOS[@]}))
    SCREENSAVER_VIDEO="${VIDEOS[$RANDOM_INDEX]}"
    
    echo "Playing: $(basename "$SCREENSAVER_VIDEO")"
fi

# Kill any existing mpvpaper
pkill mpvpaper

# Start video on top layer with input disabled
mpvpaper --layer top -o "loop panscan=1.0 input-default-bindings=no input-vo-keyboard=no" '*' "$SCREENSAVER_VIDEO" &
MPVPAPER_PID=$!

# Move cursor off-screen to hide it
sleep 0.5
hyprctl dispatch movecursor 10000 10000

# Wait for mpvpaper
wait $MPVPAPER_PID