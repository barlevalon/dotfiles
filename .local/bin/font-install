#!/bin/bash

# Font installer for popular programming fonts

install_font() {
  local display_name="$1"
  local package_name="$2"
  local font_name="$3"
  
  echo "Installing $display_name..."
  
  if yay -Sy --noconfirm --needed "$package_name"; then
    echo "✓ $display_name installed successfully"
    
    # Update font cache
    fc-cache -f
    sleep 2
    
    # Ask if user wants to set this as default font
    read -p "Set $display_name as your default font? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      font-set "$font_name"
    fi
  else
    echo "✗ Failed to install $display_name"
    return 1
  fi
}

show_menu() {
  echo "Popular Programming Fonts Installer"
  echo "===================================="
  echo ""
  echo "1) Meslo LG Nerd Font - Clean, readable, great for terminals"
  echo "2) Fira Code Nerd Font - Popular with ligatures support"
  echo "3) JetBrains Mono Nerd Font - Modern font from JetBrains"
  echo "4) Victor Mono Nerd Font - Semi-connected cursive italics"
  echo "5) Hack Nerd Font - Source code pro derivative"
  echo "6) Iosevka Nerd Font - Narrow, space-efficient"
  echo "7) Source Code Pro - Adobe's monospace font"
  echo "8) Cascadia Code Nerd Font - Microsoft's terminal font"
  echo "9) Ubuntu Mono Nerd Font - Ubuntu's default mono font"
  echo "10) Roboto Mono Nerd Font - Google's Roboto in mono"
  echo ""
  echo "a) Install all Nerd Fonts"
  echo "q) Quit"
  echo ""
  read -p "Select font to install (1-10, a, or q): " choice
  
  case $choice in
    1) install_font "Meslo LG Nerd Font" "ttf-meslo-nerd" "MesloLGM Nerd Font" ;;
    2) install_font "Fira Code Nerd Font" "ttf-firacode-nerd" "FiraCode Nerd Font" ;;
    3) install_font "JetBrains Mono Nerd Font" "ttf-jetbrains-mono-nerd" "JetBrainsMono Nerd Font" ;;
    4) install_font "Victor Mono Nerd Font" "ttf-victor-mono-nerd" "VictorMono Nerd Font" ;;
    5) install_font "Hack Nerd Font" "ttf-hack-nerd" "Hack Nerd Font" ;;
    6) install_font "Iosevka Nerd Font" "ttf-iosevka-nerd" "Iosevka Nerd Font" ;;
    7) install_font "Source Code Pro" "adobe-source-code-pro-fonts" "Source Code Pro" ;;
    8) install_font "Cascadia Code Nerd Font" "ttf-cascadia-code-nerd" "CaskaydiaCove Nerd Font" ;;
    9) install_font "Ubuntu Mono Nerd Font" "ttf-ubuntu-mono-nerd" "UbuntuMono Nerd Font" ;;
    10) install_font "Roboto Mono Nerd Font" "ttf-roboto-mono-nerd" "RobotoMono Nerd Font" ;;
    a|A) 
      echo "Installing all Nerd Fonts (this may take a while)..."
      yay -Sy --noconfirm --needed \
        ttf-meslo-nerd \
        ttf-firacode-nerd \
        ttf-jetbrains-mono-nerd \
        ttf-victor-mono-nerd \
        ttf-hack-nerd \
        ttf-iosevka-nerd \
        ttf-cascadia-code-nerd \
        ttf-ubuntu-mono-nerd \
        ttf-roboto-mono-nerd
      fc-cache -f
      echo "✓ All fonts installed!"
      ;;
    q|Q) 
      echo "Exiting..."
      exit 0
      ;;
    *)
      echo "Invalid choice"
      show_menu
      ;;
  esac
  
  echo ""
  read -p "Install another font? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    show_menu
  fi
}

# If font name provided as argument, try to install it directly
if [[ -n "$1" ]]; then
  # Try to find matching font package
  case "$1" in
    *[Mm]eslo*) install_font "Meslo LG Nerd Font" "ttf-meslo-nerd" "MesloLGM Nerd Font" ;;
    *[Ff]ira*) install_font "Fira Code Nerd Font" "ttf-firacode-nerd" "FiraCode Nerd Font" ;;
    *[Jj]et[Bb]rains*) install_font "JetBrains Mono Nerd Font" "ttf-jetbrains-mono-nerd" "JetBrainsMono Nerd Font" ;;
    *[Vv]ictor*) install_font "Victor Mono Nerd Font" "ttf-victor-mono-nerd" "VictorMono Nerd Font" ;;
    *[Hh]ack*) install_font "Hack Nerd Font" "ttf-hack-nerd" "Hack Nerd Font" ;;
    *[Ii]osevka*) install_font "Iosevka Nerd Font" "ttf-iosevka-nerd" "Iosevka Nerd Font" ;;
    *[Cc]ascadia*) install_font "Cascadia Code Nerd Font" "ttf-cascadia-code-nerd" "CaskaydiaCove Nerd Font" ;;
    *[Uu]buntu*) install_font "Ubuntu Mono Nerd Font" "ttf-ubuntu-mono-nerd" "UbuntuMono Nerd Font" ;;
    *[Rr]oboto*) install_font "Roboto Mono Nerd Font" "ttf-roboto-mono-nerd" "RobotoMono Nerd Font" ;;
    *)
      echo "Unknown font: $1"
      echo "Searching AUR for font packages..."
      yay -Ss "ttf-$1" | head -10
      ;;
  esac
else
  show_menu
fi